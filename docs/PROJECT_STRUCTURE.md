# é¡¹ç›®ç»“æ„è¯´æ˜

## ğŸ“‚ å®Œæ•´ç›®å½•ç»“æ„

```
DNS-Max/
â”‚
â”œâ”€â”€ ğŸ“ api/                         # FastAPI åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ ğŸ“ app/                     # åº”ç”¨ä»£ç 
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ main.py                 # åº”ç”¨å…¥å£
â”‚   â”‚   â”œâ”€â”€ config.py               # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ models.py               # SQLAlchemy æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ schemas.py              # Pydantic schemas
â”‚   â”‚   â”œâ”€â”€ auth.py                 # è®¤è¯é€»è¾‘ï¼ˆJWTï¼‰
â”‚   â”‚   â”œâ”€â”€ db.py                   # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â”œâ”€â”€ deps.py                 # FastAPI ä¾èµ–æ³¨å…¥
â”‚   â”‚   â”œâ”€â”€ dnspod.py               # DNSPod API é›†æˆ
â”‚   â”‚   â”œâ”€â”€ emailer.py              # é‚®ä»¶æœåŠ¡
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ routers/             # API è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.py             # è®¤è¯è·¯ç”±ï¼ˆç™»å½•/æ³¨å†Œï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ users.py            # ç”¨æˆ·è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ domains.py          # åŸŸåè·¯ç”±
â”‚   â”‚   â”‚   â””â”€â”€ admin.py            # ç®¡ç†å‘˜è·¯ç”±
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ ğŸ“ migrations/          # Alembic æ•°æ®åº“è¿ç§»
â”‚   â”‚       â”œâ”€â”€ alembic.ini
â”‚   â”‚       â”œâ”€â”€ env.py
â”‚   â”‚       â”œâ”€â”€ script.py.mako
â”‚   â”‚       â””â”€â”€ versions/           # è¿ç§»ç‰ˆæœ¬
â”‚   â”‚           â”œâ”€â”€ 001_initial.py
â”‚   â”‚           â””â”€â”€ 002_add_system_config.py
â”‚   â”‚
â”‚   â”œâ”€â”€ Dockerfile                  # API å®¹å™¨é…ç½®
â”‚   â”œâ”€â”€ requirements.txt            # Python ä¾èµ–
â”‚   â””â”€â”€ start.sh                    # å¯åŠ¨è„šæœ¬
â”‚
â”œâ”€â”€ ğŸ“ web/                         # Next.js å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ ğŸ“ src/
â”‚   â”‚   â”œâ”€â”€ middleware.ts           # Next.js ä¸­é—´ä»¶
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ app/                 # App Router
â”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx          # æ ¹å¸ƒå±€
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx            # é¦–é¡µ
â”‚   â”‚   â”‚   â”œâ”€â”€ globals.css         # å…¨å±€æ ·å¼
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ auth/            # è®¤è¯é¡µé¢
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx    # ç™»å½•é¡µ
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ register/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ page.tsx    # æ³¨å†Œé¡µ
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ dashboard/       # ç”¨æˆ·æ§åˆ¶å°
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx        # ç”¨æˆ·ä¸»é¡µ
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ admin/           # ç®¡ç†å‘˜åå°
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx        # ç®¡ç†å‘˜é¡µé¢
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ verify/          # é‚®ç®±éªŒè¯
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“ api/             # API è·¯ç”±å¤„ç†å™¨
â”‚   â”‚   â”‚       â”œâ”€â”€ _helpers.ts     # è¾…åŠ©å‡½æ•°
â”‚   â”‚   â”‚       â”œâ”€â”€ ğŸ“ session/     # ä¼šè¯ç®¡ç†
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ logout/
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ me/
â”‚   â”‚   â”‚       â”œâ”€â”€ ğŸ“ allocations/ # åˆ†é…ç®¡ç†
â”‚   â”‚   â”‚       â”œâ”€â”€ ğŸ“ domains/     # åŸŸåç®¡ç†
â”‚   â”‚   â”‚       â””â”€â”€ ğŸ“ admin/       # ç®¡ç†å‘˜API
â”‚   â”‚   â”‚           â”œâ”€â”€ allocations/
â”‚   â”‚   â”‚           â”œâ”€â”€ config/
â”‚   â”‚   â”‚           â”œâ”€â”€ domains/
â”‚   â”‚   â”‚           â””â”€â”€ users/
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ components/          # React ç»„ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“ ui/              # UI ç»„ä»¶åº“
â”‚   â”‚   â”‚       â”œâ”€â”€ alert.tsx       # æç¤ºç»„ä»¶
â”‚   â”‚   â”‚       â”œâ”€â”€ button.tsx      # æŒ‰é’®ç»„ä»¶
â”‚   â”‚   â”‚       â”œâ”€â”€ card.tsx        # å¡ç‰‡ç»„ä»¶
â”‚   â”‚   â”‚       â”œâ”€â”€ header.tsx      # é¡¶éƒ¨æ 
â”‚   â”‚   â”‚       â”œâ”€â”€ input.tsx       # è¾“å…¥æ¡†
â”‚   â”‚   â”‚       â”œâ”€â”€ loading.tsx     # åŠ è½½åŠ¨ç”»
â”‚   â”‚   â”‚       â”œâ”€â”€ modal.tsx       # æ¨¡æ€æ¡†
â”‚   â”‚   â”‚       â”œâ”€â”€ sidebar.tsx     # ä¾§è¾¹æ 
â”‚   â”‚   â”‚       â”œâ”€â”€ table.tsx       # è¡¨æ ¼ç»„ä»¶
â”‚   â”‚   â”‚       â””â”€â”€ tabs.tsx        # æ ‡ç­¾é¡µ
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ ğŸ“ lib/                 # å·¥å…·åº“
â”‚   â”‚       â”œâ”€â”€ api.ts              # API å®¢æˆ·ç«¯
â”‚   â”‚       â”œâ”€â”€ auth.ts             # è®¤è¯å·¥å…·
â”‚   â”‚       â””â”€â”€ utils.ts            # é€šç”¨å·¥å…·
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ public/                  # é™æ€èµ„æº
â”‚   â”œâ”€â”€ Dockerfile                  # Web å®¹å™¨é…ç½®
â”‚   â”œâ”€â”€ package.json                # Node.js ä¾èµ–
â”‚   â”œâ”€â”€ tsconfig.json               # TypeScript é…ç½®
â”‚   â”œâ”€â”€ next.config.js              # Next.js é…ç½®
â”‚   â”œâ”€â”€ tailwind.config.js          # Tailwind CSS é…ç½®
â”‚   â”œâ”€â”€ postcss.config.js           # PostCSS é…ç½®
â”‚   â””â”€â”€ eslint.config.mjs           # ESLint é…ç½®
â”‚
â”œâ”€â”€ ğŸ“ docs/                        # ğŸ“š é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ QUICKSTART.md               # å¿«é€Ÿå¼€å§‹æŒ‡å—
â”‚   â”œâ”€â”€ CONFIGURATION.md            # é…ç½®è¯´æ˜
â”‚   â”œâ”€â”€ DEPLOYMENT.md               # éƒ¨ç½²æŒ‡å—
â”‚   â”œâ”€â”€ API.md                      # API æ–‡æ¡£
â”‚   â””â”€â”€ TROUBLESHOOTING.md          # æ•…éšœæ’é™¤
â”‚
â”œâ”€â”€ ğŸ“ archive/                     # ğŸ“¦ å½’æ¡£æ–‡ä»¶
â”‚   â”œâ”€â”€ README.md                   # å½’æ¡£è¯´æ˜
â”‚   â”œâ”€â”€ ui-optimization/            # UIä¼˜åŒ–ç›¸å…³
â”‚   â”œâ”€â”€ old-docs/                   # æ—§æ–‡æ¡£
â”‚   â””â”€â”€ dev-pages/                  # å¼€å‘é¡µé¢
â”‚
â”œâ”€â”€ ğŸ“„ README.md                    # é¡¹ç›®ä¸»æ–‡æ¡£
â”œâ”€â”€ ğŸ“„ LICENSE                      # MIT è®¸å¯è¯
â”œâ”€â”€ ğŸ“„ docker-compose.yml           # Docker Compose é…ç½®
â”œâ”€â”€ ğŸ“„ env.example                  # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ ğŸ“„ Makefile                     # Make å‘½ä»¤
â”œâ”€â”€ ğŸ“„ .gitignore                   # Git å¿½ç•¥è§„åˆ™
â””â”€â”€ ğŸ“„ PROJECT_CLEANUP_REPORT.md    # ç²¾ç®€æ•´ç†æŠ¥å‘Š
```

## ğŸ¯ æ ¸å¿ƒç›®å½•è¯´æ˜

### api/ - åç«¯æœåŠ¡

**æŠ€æœ¯æ ˆ**: FastAPI + SQLAlchemy + PostgreSQL

**ä¸»è¦åŠŸèƒ½**:

- RESTful API æ¥å£
- JWT è®¤è¯
- æ•°æ®åº“æ“ä½œ
- DNSPod é›†æˆ
- é‚®ä»¶å‘é€

**å…³é”®æ–‡ä»¶**:

- `main.py` - åº”ç”¨å…¥å£ï¼Œè·¯ç”±æ³¨å†Œ
- `models.py` - æ•°æ®æ¨¡å‹å®šä¹‰
- `auth.py` - è®¤è¯å’Œæˆæƒé€»è¾‘
- `routers/` - API è·¯ç”±å¤„ç†

### web/ - å‰ç«¯åº”ç”¨

**æŠ€æœ¯æ ˆ**: Next.js 14 + TypeScript + Tailwind CSS

**ä¸»è¦åŠŸèƒ½**:

- ç”¨æˆ·ç•Œé¢
- çŠ¶æ€ç®¡ç†
- API è°ƒç”¨
- è·¯ç”±å¤„ç†

**å…³é”®ç›®å½•**:

- `app/` - Next.js App Router é¡µé¢
- `components/ui/` - å¯å¤ç”¨ UI ç»„ä»¶
- `lib/` - å·¥å…·å‡½æ•°å’Œ API å®¢æˆ·ç«¯

### docs/ - æ–‡æ¡£

**å†…å®¹**:

- éƒ¨ç½²æŒ‡å—
- é…ç½®è¯´æ˜
- API æ–‡æ¡£
- æ•…éšœæ’é™¤

## ğŸ“ æ–‡ä»¶å‘½åè§„èŒƒ

### Python æ–‡ä»¶ï¼ˆåç«¯ï¼‰

- **æ¨¡å—**: å°å†™å­—æ¯ï¼Œä¸‹åˆ’çº¿åˆ†éš”ï¼Œå¦‚ `user_service.py`
- **ç±»**: å¤§é©¼å³°ï¼Œå¦‚ `UserModel`
- **å‡½æ•°**: å°å†™å­—æ¯ï¼Œä¸‹åˆ’çº¿åˆ†éš”ï¼Œå¦‚ `get_user_by_id()`
- **å¸¸é‡**: å¤§å†™å­—æ¯ï¼Œä¸‹åˆ’çº¿åˆ†éš”ï¼Œå¦‚ `MAX_RETRY_COUNT`

### TypeScript æ–‡ä»¶ï¼ˆå‰ç«¯ï¼‰

- **ç»„ä»¶**: å¤§é©¼å³° + `.tsx`ï¼Œå¦‚ `UserProfile.tsx`
- **å·¥å…·**: å°é©¼å³° + `.ts`ï¼Œå¦‚ `apiClient.ts`
- **ç±»å‹**: å¤§é©¼å³°ï¼Œå¦‚ `interface UserData`
- **å¸¸é‡**: å¤§å†™å­—æ¯ï¼Œä¸‹åˆ’çº¿åˆ†éš”ï¼Œå¦‚ `API_BASE_URL`

### ç›®å½•å‘½å

- **å°å†™å­—æ¯**: ä½¿ç”¨çŸ­æ¨ªçº¿åˆ†éš”ï¼Œå¦‚ `user-profile/`
- **ç‰¹æ®Šæƒ…å†µ**: `components/ui/` ä½¿ç”¨æ–œæ åˆ†éš”

## ğŸ”§ é…ç½®æ–‡ä»¶è¯´æ˜

### æ ¹ç›®å½•é…ç½®

- `.env` - ç¯å¢ƒå˜é‡ï¼ˆéœ€åˆ›å»ºï¼Œä¸æäº¤ï¼‰
- `env.example` - ç¯å¢ƒå˜é‡æ¨¡æ¿
- `docker-compose.yml` - Docker ç¼–æ’é…ç½®
- `.gitignore` - Git å¿½ç•¥è§„åˆ™

### åç«¯é…ç½®

- `api/requirements.txt` - Python ä¾èµ–
- `api/Dockerfile` - API å®¹å™¨æ„å»º
- `api/app/migrations/alembic.ini` - æ•°æ®åº“è¿ç§»é…ç½®

### å‰ç«¯é…ç½®

- `web/package.json` - Node.js ä¾èµ–å’Œè„šæœ¬
- `web/tsconfig.json` - TypeScript ç¼–è¯‘é€‰é¡¹
- `web/next.config.js` - Next.js é…ç½®
- `web/tailwind.config.js` - Tailwind CSS é…ç½®

## ğŸ—„ï¸ æ•°æ®åº“ç»“æ„

### ä¸»è¦è¡¨

- `users` - ç”¨æˆ·è¡¨
- `domains` - åŸŸåè¡¨
- `allocations` - åŸŸååˆ†é…è®°å½•è¡¨
- `system_config` - ç³»ç»Ÿé…ç½®è¡¨

è¯¦è§: `api/app/models.py`

## ğŸŒ API è·¯ç”±ç»“æ„

### å…¬å¼€è·¯ç”±

```
POST /auth/register      # ç”¨æˆ·æ³¨å†Œ
POST /auth/login         # ç”¨æˆ·ç™»å½•
GET  /auth/verify        # é‚®ç®±éªŒè¯
GET  /healthz            # å¥åº·æ£€æŸ¥
```

### ç”¨æˆ·è·¯ç”±ï¼ˆéœ€è®¤è¯ï¼‰

```
GET  /users/me           # è·å–å½“å‰ç”¨æˆ·
GET  /allocations/mine   # è·å–æˆ‘çš„åˆ†é…
POST /allocations        # åˆ›å»ºåˆ†é…ç”³è¯·
```

### ç®¡ç†å‘˜è·¯ç”±ï¼ˆéœ€ç®¡ç†å‘˜æƒé™ï¼‰

```
GET    /admin/users           # ç”¨æˆ·åˆ—è¡¨
PATCH  /admin/users/{id}      # æ›´æ–°ç”¨æˆ·
GET    /admin/allocations     # æ‰€æœ‰åˆ†é…
POST   /admin/allocations/{id}/approve  # æ‰¹å‡†
GET    /admin/domains         # åŸŸååˆ—è¡¨
POST   /admin/domains         # æ·»åŠ åŸŸå
GET    /admin/config          # ç³»ç»Ÿé…ç½®
PUT    /admin/config          # æ›´æ–°é…ç½®
```

è¯¦è§: `docs/API.md`

## ğŸ¨ UI ç»„ä»¶è¯´æ˜

### å¸ƒå±€ç»„ä»¶

- `Header` - é¡¶éƒ¨å¯¼èˆªæ 
- `Sidebar` - ä¾§è¾¹æ èœå•
- `Layout` - é¡µé¢å¸ƒå±€å®¹å™¨

### è¡¨å•ç»„ä»¶

- `Input` - è¾“å…¥æ¡†
- `Button` - æŒ‰é’®
- `Select` - ä¸‹æ‹‰é€‰æ‹©

### å±•ç¤ºç»„ä»¶

- `Card` - å¡ç‰‡å®¹å™¨
- `Table` - æ•°æ®è¡¨æ ¼
- `Alert` - æç¤ºæ¶ˆæ¯
- `Modal` - æ¨¡æ€å¯¹è¯æ¡†
- `Tabs` - æ ‡ç­¾é¡µ
- `Loading` - åŠ è½½åŠ¨ç”»

ä½ç½®: `web/src/components/ui/`

## ğŸ“Š æ•°æ®æµå‘

```
ç”¨æˆ·æµè§ˆå™¨
    â†“ HTTPè¯·æ±‚
Next.js (web/)
    â†“ APIè°ƒç”¨
FastAPI (api/)
    â†“ SQLæŸ¥è¯¢
PostgreSQL (db)
    â†“ DNSæ“ä½œ
DNSPod API
```

## ğŸ” è®¤è¯æµç¨‹

```
1. ç”¨æˆ·ç™»å½• â†’ POST /auth/login
2. åç«¯éªŒè¯ â†’ ç”Ÿæˆ JWT
3. è®¾ç½® Cookie â†’ access_token, refresh_token
4. åç»­è¯·æ±‚ â†’ è‡ªåŠ¨æºå¸¦ Cookie
5. åç«¯éªŒè¯ â†’ è§£æ JWT â†’ è·å–ç”¨æˆ·ä¿¡æ¯
```

## ğŸš€ éƒ¨ç½²æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Nginx/Caddy   â”‚  åå‘ä»£ç† + SSL
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚         â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”
â”‚  Web  â”‚ â”‚ API  â”‚  Docker å®¹å™¨
â””â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”˜
    â”‚        â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚   DB    â”‚  PostgreSQL
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“š æ‰©å±•é˜…è¯»

- [FastAPI æ–‡æ¡£](https://fastapi.tiangolo.com/)
- [Next.js æ–‡æ¡£](https://nextjs.org/docs)
- [Tailwind CSS](https://tailwindcss.com/docs)
- [PostgreSQL](https://www.postgresql.org/docs/)
- [Docker](https://docs.docker.com/)

---

è¿”å› [README](../README.md) | æŸ¥çœ‹ [ç²¾ç®€æŠ¥å‘Š](../PROJECT_CLEANUP_REPORT.md)
